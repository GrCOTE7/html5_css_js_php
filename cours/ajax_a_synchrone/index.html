<h1>Requête synchrone</h1><div id="resultat1"></div>
<hr>
<h1>Requête asynchrone</h1><div id="resultat2"></div>
<script type="text/javascript">
  (function() {
    obj1 = document.getElementById("resultat1");
    obj2 = document.getElementById("resultat2");
// ON AFFICHE UNE PREMIERE LIGNE DANS LE DIV
    obj1.innerHTML = "Avant la requete : OK<br />";
    if (window.XMLHttpRequest) // FIREFOX
      xhr_object = new XMLHttpRequest();
    else if (window.ActiveXObject) // IE
      xhr_object = new ActiveXObject("Microsoft.XMLHTTP");
    else
      return(false);
// ON APPELLE LA PAGE en mode Synchrone
    xhr_object.open("GET", "retour_php.php", false);
    xhr_object.send(null);
// ON AFFICHE UNE SECONDE LIGNE DANS LE DIV
    obj1.innerHTML += "Apres la requete : OK<br />";
// ON AFFICHE LE RESULTAT DANS LE DIV
    res = "Contenu du fichier : " + xhr_object.responseText + '<br><i>Et fin du script JS</i>';
    obj1.innerHTML += res;


// ON AFFICHE UNE PREMIERE LIGNE DANS LE DIV
    obj2.innerHTML = "Avant la requete : OK<br />";
    if (window.XMLHttpRequest) // FIREFOX
      xhr_object = new XMLHttpRequest();
    else if (window.ActiveXObject) // IE
      xhr_object = new ActiveXObject("Microsoft.XMLHTTP");
    else
      return(false);

    // CONTROLE DE L'ETAT DE LA REQUETE
// CHAQUE CHANGEMENT D'ETAT AFFICHE UNE LIGNE DANS NOTRE DIV 
    xhr_object.onreadystatechange = function()
    {
      if (xhr_object.readyState === 1)
        obj2.innerHTML += "connexion établie<br />";
      if (xhr_object.readyState === 2)
        obj2.innerHTML += "requête reçue<br />";
      if (xhr_object.readyState === 3)
        obj2.innerHTML += "réponse en cours<br />";
      if (xhr_object.readyState === 4)
      {
        // ON CONTROLE LE STATUS (ERREUR 404, ETC)
        if (xhr_object.status === 200)
          obj2.innerHTML += "Fichier : " + xhr_object.responseText;
        else
          obj2.innerHTML += "Error code " + xhr_object.status;
      }
    };


// ON APPELLE LA PAGE en mode Asynchrone
    xhr_object.open("GET", "retour_php.php", true);
    xhr_object.send(null);
// ON AFFICHE UNE SECONDE LIGNE DANS LE DIV
    obj2.innerHTML += "Apres la requete : OK<br />";
// ON AFFICHE LE RESULTAT DANS LE DIV
    res = "Contenu du fichier : " + xhr_object.responseText;
    obj2.innerHTML += res + '<br><i>Et fin du script JS</i><br>';
  })();
</script>
